<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å…‰å¤§ç†è´¢æ•°æ®æå–å·¥å…·</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; max-width: 900px; margin: 50px auto; padding: 20px; }
        h1 { color: #51225a; }
        .step { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .step h3 { margin-top: 0; color: #333; }
        .bookmarklet { display: inline-block; padding: 10px 20px; background: #51225a; color: white;
                       text-decoration: none; border-radius: 5px; font-size: 16px; margin: 10px 0; }
        .bookmarklet:hover { background: #6b2d75; }
        code { background: #eee; padding: 2px 6px; border-radius: 3px; }
        .note { color: #666; font-size: 14px; }
        #result { background: #f0f0f0; padding: 15px; margin-top: 20px; max-height: 400px; overflow: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ¦ å…‰å¤§ç†è´¢æ•°æ®æå–å·¥å…·</h1>

    <div class="step">
        <h3>æ­¥éª¤1: æ·»åŠ ä¹¦ç­¾</h3>
        <p>å°†ä¸‹é¢çš„æŒ‰é’®<strong>æ‹–åŠ¨</strong>åˆ°æµè§ˆå™¨ä¹¦ç­¾æ ï¼š</p>

        <a class="bookmarklet" href="javascript:(function(){var s=document.createElement('script');s.src='https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js';document.body.appendChild(s);var d={products:[],navHistory:{}};function extractProducts(){var tables=document.querySelectorAll('table');for(var t of tables){var rows=t.querySelectorAll('tr');if(rows.length>5){for(var i=1;i<rows.length;i++){var cells=rows[i].querySelectorAll('td');if(cells.length>=10){var code=cells[1]?.textContent?.trim();if(code&&code.startsWith('EB')){d.products.push({name:cells[0]?.textContent?.trim(),code:code,startAmount:cells[2]?.textContent?.trim(),unitNav:cells[3]?.textContent?.trim(),totalNav:cells[4]?.textContent?.trim(),assetNav:cells[5]?.textContent?.trim(),monthChange:cells[6]?.textContent?.trim(),yearChange:cells[7]?.textContent?.trim(),totalChange:cells[8]?.textContent?.trim(),risk:cells[9]?.textContent?.trim()});}}}}}return d.products.length;}function extractNav(){var code=document.querySelector('title')?.textContent?.match(/EB\\d+/)?.[0]||'unknown';var navs=[];var text=document.body.innerText;var matches=text.matchAll(/(\\d{4}-\\d{2}-\\d{2})\\s+([\\d.]+)\\s+([\\d.]+)/g);for(var m of matches){navs.push({date:m[1],unitNav:m[2],totalNav:m[3]});}if(navs.length>0){d.navHistory[code]=navs;}return navs.length;}var count=0;if(location.href.includes('grlc/index')){count=extractProducts();alert('æå–äº† '+count+' ä¸ªäº§å“!\\n\\nè¯·ç‚¹å‡»æ¯ä¸ªäº§å“è¿›å…¥è¯¦æƒ…é¡µï¼Œå†æ¬¡ç‚¹å‡»ä¹¦ç­¾æå–å‡€å€¼ã€‚');}else if(location.href.includes('lcxx/lccp')){count=extractNav();alert('æå–äº† '+count+' æ¡å‡€å€¼è®°å½•!');}var existing=localStorage.getItem('cebwm_data');if(existing){try{var old=JSON.parse(existing);d.products=[...old.products,...d.products];d.navHistory={...old.navHistory,...d.navHistory};}catch(e){}}localStorage.setItem('cebwm_data',JSON.stringify(d));console.log('æ•°æ®å·²ä¿å­˜',d);})();">ğŸ“Š æå–å…‰å¤§æ•°æ®</a>

        <p class="note">å¦‚æœæ— æ³•æ‹–åŠ¨ï¼Œè¯·å³é”®ç‚¹å‡» â†’ æ·»åŠ åˆ°ä¹¦ç­¾</p>
    </div>

    <div class="step">
        <h3>æ­¥éª¤2: æå–äº§å“åˆ—è¡¨</h3>
        <ol>
            <li>æ‰“å¼€ <a href="https://www.cebwm.com/wealth/grlc/index.html" target="_blank">å…‰å¤§ç†è´¢äº§å“åˆ—è¡¨é¡µ</a></li>
            <li>ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½</li>
            <li>ç‚¹å‡»ä¹¦ç­¾æ çš„ <code>ğŸ“Š æå–å…‰å¤§æ•°æ®</code></li>
            <li>ç¿»é¡µåå†æ¬¡ç‚¹å‡»ä¹¦ç­¾æå–æ›´å¤šäº§å“</li>
        </ol>
    </div>

    <div class="step">
        <h3>æ­¥éª¤3: æå–å†å²å‡€å€¼</h3>
        <ol>
            <li>ç‚¹å‡»äº§å“åç§°è¿›å…¥è¯¦æƒ…é¡µ</li>
            <li>ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆï¼ˆçœ‹åˆ°åº•éƒ¨çš„å‡€å€¼è¡¨æ ¼ï¼‰</li>
            <li>ç‚¹å‡»ä¹¦ç­¾ <code>ğŸ“Š æå–å…‰å¤§æ•°æ®</code> æå–å‡€å€¼</li>
            <li>é‡å¤ä»¥ä¸Šæ­¥éª¤æå–æ›´å¤šäº§å“çš„å‡€å€¼</li>
        </ol>
    </div>

    <div class="step">
        <h3>æ­¥éª¤4: å¯¼å‡ºæ•°æ®</h3>
        <p>å°†ä¸‹é¢çš„æŒ‰é’®æ‹–åˆ°ä¹¦ç­¾æ ï¼Œç”¨äºå¯¼å‡ºå·²æ”¶é›†çš„æ•°æ®ï¼š</p>

        <a class="bookmarklet" href="javascript:(function(){var d=localStorage.getItem('cebwm_data');if(!d){alert('æ²¡æœ‰æ•°æ®!è¯·å…ˆä½¿ç”¨æå–ä¹¦ç­¾ã€‚');return;}var data=JSON.parse(d);var csv='é“¶è¡Œ,äº§å“åç§°,äº§å“ä»£ç ,èµ·ç‚¹é‡‘é¢,å•ä½å‡€å€¼,ç´¯è®¡å‡€å€¼,èµ„äº§å‡€å€¼,è¿‘ä¸€æœˆæ¶¨è·Œå¹…,è¿‘ä¸€å¹´æ¶¨è·Œå¹…,æˆç«‹ä»¥æ¥æ¶¨è·Œå¹…,é£é™©ç­‰çº§\\n';for(var p of data.products){csv+=['å…‰å¤§ç†è´¢',p.name,p.code,p.startAmount,p.unitNav,p.totalNav,p.assetNav,p.monthChange,p.yearChange,p.totalChange,p.risk].join(',')+'\n';}var blob=new Blob([csv],{type:'text/csv;charset=utf-8'});var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='å…‰å¤§ç†è´¢_äº§å“åˆ—è¡¨.csv';a.click();var navCsv='äº§å“ä»£ç ,æ—¥æœŸ,å•ä½å‡€å€¼,ç´¯è®¡å‡€å€¼\\n';for(var code in data.navHistory){for(var n of data.navHistory[code]){navCsv+=[code,n.date,n.unitNav,n.totalNav].join(',')+'\n';}}var blob2=new Blob([navCsv],{type:'text/csv;charset=utf-8'});var a2=document.createElement('a');a2.href=URL.createObjectURL(blob2);a2.download='å…‰å¤§ç†è´¢_å‡€å€¼å†å².csv';a2.click();alert('å·²å¯¼å‡º '+data.products.length+' ä¸ªäº§å“å’Œ '+Object.keys(data.navHistory).length+' ä¸ªäº§å“çš„å‡€å€¼å†å²!');})();">ğŸ’¾ å¯¼å‡ºCSVæ•°æ®</a>

        <a class="bookmarklet" href="javascript:(function(){localStorage.removeItem('cebwm_data');alert('æ•°æ®å·²æ¸…ç©º!');})();" style="background:#999;">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</a>
    </div>

    <div class="step">
        <h3>å½“å‰å·²æ”¶é›†çš„æ•°æ®</h3>
        <button onclick="showData()">æŸ¥çœ‹æ•°æ®</button>
        <button onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
        <div id="result"></div>
    </div>

    <script>
        function showData() {
            var d = localStorage.getItem('cebwm_data');
            var result = document.getElementById('result');
            if (!d) {
                result.innerHTML = '<p class="error">æš‚æ— æ•°æ®ã€‚è¯·å…ˆä½¿ç”¨ä¹¦ç­¾æå–æ•°æ®ã€‚</p>';
                return;
            }
            var data = JSON.parse(d);
            var html = '<p class="success">äº§å“æ•°: ' + data.products.length + '</p>';
            html += '<p class="success">æœ‰å‡€å€¼å†å²çš„äº§å“: ' + Object.keys(data.navHistory).length + '</p>';

            html += '<h4>äº§å“åˆ—è¡¨:</h4><ul>';
            for (var p of data.products.slice(0, 20)) {
                html += '<li>' + p.code + ': ' + p.name + ' (å‡€å€¼: ' + p.unitNav + ')</li>';
            }
            if (data.products.length > 20) {
                html += '<li>... è¿˜æœ‰ ' + (data.products.length - 20) + ' ä¸ªäº§å“</li>';
            }
            html += '</ul>';

            html += '<h4>å‡€å€¼å†å²:</h4><ul>';
            for (var code in data.navHistory) {
                html += '<li>' + code + ': ' + data.navHistory[code].length + ' æ¡è®°å½•</li>';
            }
            html += '</ul>';

            result.innerHTML = html;
        }

        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—?')) {
                localStorage.removeItem('cebwm_data');
                document.getElementById('result').innerHTML = '<p>æ•°æ®å·²æ¸…ç©º</p>';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ•°æ®
        showData();
    </script>
</body>
</html>
